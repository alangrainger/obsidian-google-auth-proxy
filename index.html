<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Obsidian Google Auth proxy</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.css">
</head>

<body>
  <main>
    <h1>Authentication in progress</h1>
    <p>Please wait and you should be redirected back to Obsidian.</p>
    <p>If it does not automatically redirect, please click this link:</p>
    <p><a id="redirect-link" href="" target="_blank"></a></p>
  </main>
  <script>
    // Get the handler parameter so we can send to the correct protocol handler
    const params = (new URL(document.location)).searchParams
    const handler = params.get('handler')

    // Redirect to Obsidian and transparently pass the full search query
    if (handler) {
      const link = 'obsidian://' + handler + window.location.search
      const linkEl = document.getElementById('redirect-link')
      linkEl.setAttribute('href', link)
      linkEl.innerText = link
      window.open(link)
    }
  </script>
</body>

</html>
